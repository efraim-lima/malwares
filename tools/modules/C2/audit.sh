#!/bin/bash

# Comando a ser executado
COMMAND="nc -lvp 2222"

# Arquivo CSV para salvar as saídas
CSV_FILE="output.csv"

while true; do
    # Verificar se um comando com o fragmento está em execução
    if ! pgrep -f "$COMMAND" > /dev/null; then
        echo "Executando..."
        # Executar o comando e adicionar data e hora a cada linha de saída
        $COMMAND 2>&1 | while read line; do
            timestamp=$(date '+%Y-%m-%d %H:%M:%S')
            echo "$timestamp,$line"
        done | tee -a "output.csv"
    else
        # Loop para manter o comando em execução
            echo "Comando: $COMMAND"
    fi
    sleep 5
done
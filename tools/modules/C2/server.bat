@echo off

REM Função para instalar o OpenVPN
:Install-OpenVPN
choco install openvpn -y
goto Configure-OpenVPN-Server

REM Função para configurar o servidor OpenVPN
:Configure-OpenVPN-Server
set /p IP_PUBLICO_AMIGO=Digite o endereço IP público ou o subdomínio que aponta para o computador do seu amigo:
set /p PORTA_OPENVPN=Digite a porta do servidor OpenVPN (recomendado: 1194):
set /p PROTOCOLO_OPENVPN=Digite o protocolo do servidor OpenVPN (recomendado: udp):

REM Criação do arquivo de configuração do servidor
(
  echo local 0.0.0.0
  echo port %PORTA_OPENVPN%
  echo proto %PROTOCOLO_OPENVPN%
  echo dev tun
  echo ca ca.crt
  echo cert server.crt
  echo key server.key
  echo dh dh.pem
  echo server 10.8.0.0 255.255.255.0
  echo ifconfig-pool-persist ipp.txt
  echo push "redirect-gateway def1 bypass-dhcp"
  echo push "dhcp-option DNS 8.8.8.8"
  echo push "dhcp-option DNS 8.8.4.4"
  echo keepalive 10 120
  echo comp-lzo
  echo persist-key
  echo persist-tun
  echo status openvpn-status.log
  echo verb 3
  echo cipher AES-256-CBC
) > "C:\Program Files\OpenVPN\config\server.conf"

REM Criação do diretório de certificados
mkdir "C:\Program Files\OpenVPN\config\easy-rsa"

REM Salvar os certificados no seu computador
copy "C:\Program Files\OpenVPN\easy-rsa\pki\ca.crt" "C:\Program Files\OpenVPN\config\"
copy "C:\Program Files\OpenVPN\easy-rsa\pki\issued\server.crt" "C:\Program Files\OpenVPN\config\"
copy "C:\Program Files\OpenVPN\easy-rsa\pki\private\server.key" "C:\Program Files\OpenVPN\config\"
copy "C:\Program Files\OpenVPN\easy-rsa\pki\dh.pem" "C:\Program Files\OpenVPN\config\"

goto Start-OpenVPN-Server

REM Função para iniciar o OpenVPN
:Start-OpenVPN-Server
start "" "C:\Program Files\OpenVPN\bin\openvpn.exe" --config "C:\Program Files\OpenVPN\config\server.conf"
